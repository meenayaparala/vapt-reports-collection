
# 08. Brute Forcing 2FA Verification Code to Access Another User's Account

## 2. CVSS Score

**CVSS v3.1 Base Score: 7.0 (High)**
**CWE-287: Improper Authentication**

---

## 3. OWASP Top 10 Reference

* **A07:2021 – Identification and Authentication Failures**
* **A05:2021 – Security Misconfiguration**

---

## 4. Description of Vulnerability

This lab demonstrates an insecure 2FA implementation where the **verify parameter** controls which user's 2FA code is being verified. By manipulating this parameter and brute forcing the 2FA code, an attacker can bypass authentication and access another user's account.

---

## 5. Detailed Explanation of What We Performed

The server uses the **verify parameter** in the `/login2` POST request to identify the user for whom the 2FA code is being verified. The lack of proper binding between the login session and 2FA verification allows an attacker to:

* Trigger generation of a 2FA code for another user (`carlos`) by sending a modified GET `/login2` request.
* Submit an invalid 2FA code and send the request to Burp Intruder.
* Set `verify` parameter to the victim username (`carlos`) and brute force the `mfa-code`.
* Upon receiving a successful (302) response, gain access to the victim’s account.

---

## 6. Step-by-Step Procedure

### Step 1: Investigate 2FA Verification Process

1. Log in to your own account.
2. Intercept the POST `/login2` request where the 2FA code is submitted.
3. Note the `verify` parameter which indicates the user being verified.

---

### Step 2: Generate 2FA Code for Target User

4. Log out of your account.
5. Send the GET `/login2` request to Burp Repeater.
6. Modify the `verify` parameter value to `carlos`.
7. Send the request to trigger generation of a 2FA code for Carlos.

---

### Step 3: Prepare for Brute Forcing

8. Go to the login page and enter your username and password.
9. Submit an invalid 2FA code.
10. Intercept the POST `/login2` request and send it to Burp Intruder.
11. Set the `verify` parameter to `carlos`.
12. Add a payload position to the `mfa-code` parameter.

---

### Step 4: Brute Force 2FA Code

13. Start the Intruder attack to brute force the 2FA verification code.
14. Monitor the responses to find a **302 redirect** indicating a successful login.

---

### Step 5: Access Victim’s Account

15. Load the 302 response in the browser.
16. Click **My account** to confirm access.
17. Lab is solved.

---

## 7. Impact of the Vulnerability

* Allows attackers to bypass 2FA protections by brute forcing the verification code.
* Enables unauthorized access to victim accounts by manipulating the `verify` parameter.
* Compromises the intended security provided by multi-factor authentication.

---

## 8. Recommendations and Mitigations

* Bind the 2FA verification code to the authenticated session user.
* Ensure `verify` parameter cannot be manipulated to target other users.
* Implement rate limiting and lockouts on 2FA verification attempts.
* Use more secure 2FA methods with unpredictable time-based or challenge-response tokens.

---

## 9. References

* [OWASP Authentication Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html)
* [PortSwigger Lab: Bypassing 2FA via brute force](https://portswigger.net/web-security/authentication/multi-factor/lab-2fa-bypass-brute-force)

---

## 10. Proof of Concept

### Example Modified GET Request to Generate 2FA Code for Carlos:

```
GET /login2?verify=carlos HTTP/1.1
Host: target-lab.com
...
```

### Example POST Request to Brute Force 2FA Code:

```http
POST /login2 HTTP/1.1
Content-Type: application/x-www-form-urlencoded
...

verify=carlos&mfa-code=§code§
```

* Payload (code): List of possible 2FA codes (e.g., 000000–999999)


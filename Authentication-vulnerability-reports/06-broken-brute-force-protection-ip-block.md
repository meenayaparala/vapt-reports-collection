
# 06. Account Lockout Bypass via Interleaved Login Attempts and Pitchfork Attack

## 2. CVSS Score

**CVSS v3.1 Base Score: 6.5 (Medium)**
**CWE-307: Improper Restriction of Excessive Authentication Attempts**

---

## 3. OWASP Top 10 Reference

* **A07:2021 – Identification and Authentication Failures**
* **A05:2021 – Security Misconfiguration**

---

## 4. Description of Vulnerability

This lab demonstrates a way to **bypass account lockout or rate-limiting protections** by interleaving login attempts between a valid user and a target user using a Burp Intruder pitchfork attack with carefully aligned payloads.

By logging in with your own valid account between failed login attempts for the target user, the server resets the failed login counter, allowing brute forcing the target user’s password despite the lockout mechanism.

---

## 5. Detailed Explanation of What We Performed

We observed that after 3 failed login attempts from the same IP, the server temporarily blocks further attempts. However, logging in successfully with a valid account resets the counter, allowing more attempts.

Using Burp Intruder's **Pitchfork attack** with **Maximum concurrent requests set to 1**, we alternated payloads between our own username and the target username (`carlos`), aligned with the password list.

This ensured login attempts were sequentially sent, and the server reset the failed attempt counter each time our valid account logged in, enabling brute force of `carlos`’ password without triggering lockout.

---

## 6. Step-by-Step Procedure

### Step 1: Observe IP Lockout

1. Attempt to log in with invalid credentials 3 times.
2. Confirm temporary IP block on further attempts.

---

### Step 2: Prepare Burp Intruder Pitchfork Attack

3. Send a login POST request with invalid username/password to Burp Intruder.
4. Select **Pitchfork** attack type.
5. In **Resource pool**, set **Maximum concurrent requests** to 1 to maintain order.

---

### Step 3: Configure Payloads

6. For **Payload 1 (username)**, create a list alternating between your username (first entry) and `carlos` repeated at least 100 times, ensuring your username is first.
7. For **Payload 2 (password)**, create a list alternating between your own password and candidate passwords for `carlos`, aligned with the usernames.

---

### Step 4: Launch the Attack and Analyze Results

8. Start the attack.
9. Filter results to hide 200 status code responses.
10. Sort remaining responses by username.
11. Identify the single **302 response** associated with username `carlos`.
12. Note the password from the **Payload 2** column corresponding to this 302 response.

---

### Step 5: Verify and Solve the Lab

13. Log in to `carlos`’ account using the identified password.
14. Access his account page to complete the lab.

---

## 7. Impact of the Vulnerability

* Allows **brute force attacks** despite lockout or rate limiting.
* Enables attackers to guess passwords for target accounts without triggering security controls.
* Increases risk of **account compromise** and unauthorized access.

---

## 8. Recommendations and Mitigations

* Implement **per-account lockout** rather than IP-based lockout.
* Track and limit login attempts independently per user.
* Use **multi-factor authentication (MFA)** to mitigate password brute force.
* Monitor and alert on unusual login patterns, such as frequent switching between accounts.

---

## 9. References

* [OWASP Authentication Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html)
* [PortSwigger Lab: Account lockout bypass via pitchfork attack](https://portswigger.net/web-security/authentication/password-based/lab-account-lockout-bypass)

---

## 10. Proof of Concept

### Pitchfork Attack Payload for Alternating Usernames and Passwords:

```http
POST /login HTTP/1.1
Content-Type: application/x-www-form-urlencoded
...

username=§username§&password=§password§
```

* **Payload 1 (username):**
  `your_username`, `carlos`, `carlos`, `carlos`, ... (100+ times)
* **Payload 2 (password):**
  `your_password`, `password1`, `password2`, `password3`, ...


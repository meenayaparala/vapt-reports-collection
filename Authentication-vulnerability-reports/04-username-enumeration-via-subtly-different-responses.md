
# 04. User Enumeration via Subtle Differences in Error Messages

## 2. CVSS Score

**CVSS v3.1 Base Score: 6.5 (Medium)**
**CWE-204: Response Discrepancy Information Exposure**

---

## 3. OWASP Top 10 Reference

* **A07:2021 – Identification and Authentication Failures**
* **A06:2021 – Vulnerable and Outdated Components**

---

## 4. Description of Vulnerability

This lab demonstrates a **user enumeration vulnerability** through **minor inconsistencies in error messages**. Although the application displays the same message for both valid and invalid usernames at first glance, careful inspection reveals a **subtle difference** — like a trailing space or punctuation variation — when a valid username is submitted.

This allows an attacker to **enumerate valid usernames**, and subsequently, a **brute-force attack** can be used to discover their passwords.

---

## 5. Detailed Explanation of What We Performed

We used **Burp Suite Intruder** to send multiple login attempts using a list of potential usernames. By extracting the response error message using **Grep - Extract**, we observed slight variations in the responses. For one username, the error message had a **trailing space instead of a period**.

We identified this as the **valid username**, then performed a **password brute-force** attack against this account. A 302 redirect in the response indicated successful login.

---

## 6. Step-by-Step Procedure

### Step 1: Intercept and Send Login Request to Intruder

1. Log in with any **invalid username and password** (e.g., `test:test`).
2. In Burp Suite, go to **Proxy > HTTP History** and locate the `POST /login` request.
3. Send the request to **Intruder** and highlight the `username` parameter as the payload position.
4. Use a **static password** like `password123`.

---

### Step 2: Add Username List and Configure Grep - Extract

5. In the Intruder tab, under **Payloads**, set:

   * **Payload type:** Simple list
   * **Payloads:** List of possible usernames (e.g., `alice`, `bob`, `carlos`, etc.)

6. Go to the **Settings** tab and select **Grep - Extract**.

7. Click **Add**, scroll through the response to locate:

   * `Invalid username or password.`
   * Highlight this message and click **OK** to extract it from all responses.

---

### Step 3: Start Attack and Analyze Responses

8. Start the Intruder attack.
9. After completion, **sort results by the extracted error message**.
10. One response has a **trailing space** instead of a full stop (`.`). This indicates a **valid username** (e.g., `carlos`).

---

### Step 4: Perform Password Brute-force on Valid Username

11. In the Intruder tab, click **Clear §** and update the payload position:

```http
username=carlos&password=§password§
```

12. Under **Payloads**, load a list of possible passwords.

13. Start the attack and observe the **HTTP status code** in the results.

    * A `302 Found` response indicates a successful login.

---

### Step 5: Log In and Solve the Lab

14. Use the **identified username and password** to log in.
15. Visit the **My Account** page to confirm success and solve the lab.

---

## 7. Impact of the Vulnerability

* Allows attackers to **identify valid usernames**, aiding in brute-force attacks.
* Enables **targeted credential stuffing** on known accounts.
* May expose **admin or high-privilege usernames**.

---

## 8. Recommendations and Mitigations

* Display **generic error messages** like `Invalid login` regardless of username validity.
* **Normalize all login failure responses** (length, content, timing).
* Implement **rate-limiting and account lockout** mechanisms.
* Use **2FA** to reduce brute-force impact.

---

## 9. References

* [OWASP Authentication Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html)
* [PortSwigger: Username Enumeration](https://portswigger.net/web-security/authentication/password-based)

---

## 10. Proof of Concept

### Initial Payload (Username Enumeration):

```http
POST /login HTTP/1.1
Content-Type: application/x-www-form-urlencoded
...
username=§test§&password=password123
```

**Result**: One response differs slightly — e.g., trailing space instead of period.

---

### Brute-force Login:

```http
POST /login HTTP/1.1
...
username=carlos&password=§pass§
```

**Result**: One request returns **302 Redirect**, indicating valid credentials.


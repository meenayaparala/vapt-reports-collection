
# 5. Server-Side Template Injection in Django Template

## 2. CVSS Score

**CVSS v3.1 Base Score: 7.5 (High)**
**CWE-94: Improper Control of Generation of Code ('Code Injection')**

---

## 3. OWASP Top 10 Reference

* **A03:2021 – Injection**

---

## 4. Description of Vulnerability

The application uses the Django template engine to render product descriptions. It allows editing templates, and user-supplied inputs are rendered without sufficient validation. This enables Server-Side Template Injection (SSTI). By injecting the `{% debug %}` built-in template tag, it is possible to reveal internal variables and objects, including sensitive information like the Django `settings.SECRET_KEY`. Exposing the secret key compromises the entire application security.

---

## 5. Detailed Explanation of What We Performed

* Logged into the application and edited a product description template.
* Injected an invalid template expression like `${{<%[%'"}}%\` to confirm template rendering errors, identifying Django as the framework by the error messages.
* Removed the invalid syntax and inserted `{% debug %}` in the template.
* Saved the template and observed a debug output showing accessible objects and variables within the template context.
* Noticed the presence of the `settings` object which contains critical configuration.
* Consulted Django documentation to confirm the presence of the `SECRET_KEY` attribute within `settings`.
* Replaced the debug tag with `{{settings.SECRET_KEY}}` to extract the secret key.
* Saved the template and retrieved the secret key displayed on the page.
* Submitted the secret key to solve the lab.

---

## 6. Step-by-Step Procedure

### Step 1: Identify Template Engine and Injection Point

1. Log into the application.
2. Navigate to product description template editing.
3. Enter invalid syntax like `${{<%[%'"}}%\` and save.
4. Observe error output indicating Django template engine.

---

### Step 2: Use Debug Built-in to Discover Context

5. Remove invalid syntax.
6. Enter `{% debug %}` in the template and save.
7. Review the output to identify accessible objects, especially `settings`.

---

### Step 3: Extract SECRET\_KEY

8. Replace `{% debug %}` with `{{settings.SECRET_KEY}}`.
9. Save the template.
10. View the rendered template showing the secret key.

---

### Step 4: Submit Solution

11. Copy the secret key.
12. Click "Submit solution" and enter the secret key.

---

## 7. Impact of the Vulnerability

* Disclosure of Django SECRET\_KEY, which can be used to forge sessions, reset passwords, or tamper with cryptographic signatures.
* Potential complete compromise of application security.
* Severe confidentiality and integrity risks.

---

## 8. Recommendations and Mitigations

* Avoid allowing users to edit templates or sanitize all input thoroughly.
* Disable debug and internal template tags on production environments.
* Restrict access to sensitive objects and properties within templates.
* Use template sandboxing or whitelist safe variables only.
* Rotate secret keys immediately if exposure occurs.

---

## 9. References

* [Django Template Language](https://docs.djangoproject.com/en/stable/ref/templates/language/)
* [Django settings.SECRET\_KEY](https://docs.djangoproject.com/en/stable/ref/settings/#secret-key)
* [OWASP Injection Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Injection_Prevention_Cheat_Sheet.html)
* [PortSwigger Labs – SSTI](https://portswigger.net/web-security/template-injection)


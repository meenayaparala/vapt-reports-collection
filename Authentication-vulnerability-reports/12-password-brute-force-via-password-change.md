
# 12. Password Enumeration via Password Change Error Messages

## 2. CVSS Score

**CVSS v3.1 Base Score: 6.5 (Medium)**
**CWE-209: Information Exposure Through an Error Message**
**CWE-204: Response Discrepancy Information Leak**

---

## 3. OWASP Top 10 Reference

* **A05:2021 – Security Misconfiguration**
* **A07:2021 – Identification and Authentication Failures**

---

## 4. Description of Vulnerability

The password change functionality leaks information that allows an attacker to enumerate valid passwords for a given username by analyzing different error messages. When submitting the password change form:

* If the current password is incorrect but new passwords differ, the error says **"Current password is incorrect."**
* If the current password is correct but new passwords do not match, the error says **"New passwords do not match."**
* When multiple incorrect current passwords are tested, only the valid password triggers the **"New passwords do not match."** message, enabling password enumeration.

---

## 5. Detailed Explanation of What We Performed

* Logged in and navigated to the password change form.
* Observed the hidden username field is submitted with the form.
* Sent POST requests with `username=carlos`, varied `current-password` payloads, and two mismatching new passwords.
* Used Burp Intruder with a grep match rule looking for **"New passwords do not match"** in responses.
* Identified one password where this message appeared, confirming it as the valid current password.
* Logged in as Carlos with the discovered password to solve the lab.

---

## 6. Step-by-Step Procedure

### Step 1: Intercept Password Change Request

1. Log in with your own account.
2. Open the password change form and intercept the POST `/my-account/change-password` request.
3. Note the hidden `username` parameter and the `current-password`, `new-password-1`, and `new-password-2` fields.

---

### Step 2: Prepare the Intruder Attack

4. Send the POST request to Burp Intruder.
5. Change the `username` parameter to `carlos`.
6. Add a payload position to `current-password`.
7. Set `new-password-1` and `new-password-2` to two different values, e.g., `123` and `abc`.

---

### Step 3: Configure Payloads and Grep Match

8. In Payloads, add your password list for `current-password`.
9. In Settings, add a grep match rule for the string:

```
New passwords do not match
```

---

### Step 4: Start the Attack and Analyze Results

10. Start the Intruder attack.
11. Review the results for responses containing the grep match string.
12. Identify the password that triggers the **"New passwords do not match"** message.

---

### Step 5: Confirm Valid Password and Solve Lab

13. Log out of your account.
14. Log in as Carlos using the identified password.
15. Access the My Account page to complete the lab.

---

## 7. Impact of the Vulnerability

* Enables an attacker to enumerate valid passwords based on distinct error messages.
* Can be leveraged as a stepping stone for brute-force attacks or targeted password guessing.
* Reveals sensitive information through inconsistent error handling.

---

## 8. Recommendations and Mitigations

* Avoid revealing detailed error messages that differentiate between incorrect passwords and other input validation errors.
* Use generic error messages such as **"Invalid username or password."**
* Implement consistent response times and error responses to mitigate timing and enumeration attacks.
* Employ account lockout or rate-limiting mechanisms to defend against brute-force attacks.

---

## 9. References

* [OWASP Authentication Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html)
* [OWASP Error Handling Guidelines](https://owasp.org/www-community/attacks/Information_Leak_through_Error_Message)
* [PortSwigger Labs – Password Enumeration](https://portswigger.net/web-security/authentication/password-based/lab-password-enumeration-via-timing)

